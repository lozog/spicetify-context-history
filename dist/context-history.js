(async()=>{for(;!Spicetify.React||!Spicetify.ReactDOM;)await new Promise(e=>setTimeout(e,10));var i,n,r,a,c,l,t,s,u,f,y,e;function p(){var e;try{return JSON.parse(null!=(e=localStorage.getItem(t))?e:"[]")}catch(e){return[]}}function d(e){localStorage.setItem(t,JSON.stringify(e))}function o(){Spicetify.Player.addEventListener("songchange",async()=>{let i=Spicetify.Player.data,n=Spicetify.Player.getShuffle();setTimeout(async()=>{var e,t,o=(await Spicetify.Platform.PlayerAPI.getQueue()).nextUp;i&&(e=i.context.uri,y&&e!==y&&console.log("Context changed from",y,"to",e),e={contextUri:e,trackUri:i.item.uri,trackName:i.item.name,index:i.index,progressMs:i.positionAsOfTimestamp,isShuffled:n,nextFrom:o},u.info(`saving new context. current song: ${e.trackName}. next up: `+(null==(o=null==(o=e.nextFrom)?void 0:o[0])?void 0:o.name)),e!==f&&(f&&(o=f,(t=p()).push(o),t.length>s&&(console.log("Max stack size reached. Removing oldest items."),t.splice(0,t.length-s)),d(t)),f=e),y=i.context.uri)},250)})}async function m(){r=p(),a=r.pop(),d(r);var r=a;if(r){if(u.info("restoring previous context:",r),await Spicetify.Player.playUri(r.contextUri,{featureIdentifier:"context_back_button"},{skipTo:{index:r.index.itemIndex,pageIndex:null!=(a=r.index.pageIndex)?a:0}}),null!=(a=r.nextFrom)&&a.length){{var a=r.nextFrom;u.debug("addToNext",a);let e=a.map(e=>({uri:e.uri})),t=e.reduce((e,t)=>(e.push(t.uri),e),[]),o=(u.debug("uriObjects:",e),await Spicetify.Platform.PlayerAPI.getQueue()),i=(u.debug("queue:",o),o.nextUp.filter(e=>t.includes(e.uri))),n={uri:null==(a=o.nextUp[0])?void 0:a.uri,uid:null==(a=o.nextUp[0])?void 0:a.uid};await Spicetify.Platform.PlayerAPI.insertIntoQueue(e,l({},n.uri?{before:n}:{})).then(()=>Spicetify.showNotification("Added to Play Next")).catch(e=>{console.error("Failed to add to queue",e),Spicetify.showNotification("Unable to Add! Check Console.",!0)}),await Spicetify.Platform.PlayerAPI.removeFromQueue(i).then(()=>Spicetify.showNotification("Removed from Play Next")).catch(e=>{console.error("Failed to remove from queue",e),Spicetify.showNotification("Unable to Add! Check Console.",!0)})}await 0,Spicetify.showNotification("Restored context and Next From")}}else Spicetify.showNotification("No previous context")}i=Object.defineProperty,n=Object.getOwnPropertySymbols,r=Object.prototype.hasOwnProperty,a=Object.prototype.propertyIsEnumerable,c=(e,t,o)=>t in e?i(e,t,{enumerable:!0,configurable:!0,writable:!0,value:o}):e[t]=o,l=(e,t)=>{for(var o in t=t||{})r.call(t,o)&&c(e,o,t[o]);if(n)for(var o of n(t))a.call(t,o)&&c(e,o,t[o]);return e},t="contextStack",s=3,(u=class{static debug(...e){u.VERBOSE&&u.info(...e)}static info(...e){u.ENABLED&&console.log(...e)}static warning(...e){u.ENABLED&&console.warn(...e)}static error(...e){u.ENABLED&&console.error(...e)}}).ENABLED=!0,u.VERBOSE=!1,y=f=null,Spicetify.Platform.PlayerAPI,e=async function(){for(u.info("Starting context-history");null==Spicetify||!Spicetify.showNotification;)await new Promise(e=>setTimeout(e,100));Spicetify.showNotification("Context History loaded"),o(),new Spicetify.Playbar.Button("Go to previous context","chevron-left",()=>{Spicetify.showNotification("Back"),m()},!1,!1),new Spicetify.Playbar.Button("Clear context history","x",()=>{Spicetify.showNotification("Cleared context history"),localStorage.removeItem(t)},!1,!1),new Spicetify.Playbar.Button("Print context history","voice",()=>{var e;0===(e=p()).length?console.log("No context history"):e.forEach((e,t)=>{console.log(`context ${t}, playing: ${e.trackName}, next up: ${null==(t=null==(t=e.nextFrom)?void 0:t[0])?void 0:t.name}, ${null==(t=null==(t=e.nextFrom)?void 0:t[1])?void 0:t.name}, `+(null==(e=null==(t=e.nextFrom)?void 0:t[2])?void 0:e.name))})},!1,!1)},(async()=>{await e()})()})();