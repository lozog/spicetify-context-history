(async()=>{for(;!Spicetify.React||!Spicetify.ReactDOM;)await new Promise(e=>setTimeout(e,10));var i,n,r,a,c,l,u,t,s,f,e;function d(){var e;try{return JSON.parse(null!=(e=localStorage.getItem(t))?e:"[]")}catch(e){return[]}}function p(e){localStorage.setItem(t,JSON.stringify(e))}function o(){Spicetify.Player.addEventListener("songchange",async()=>{let n=Spicetify.Player.data,r=Spicetify.Player.getShuffle();setTimeout(async()=>{var e,t,o,i=(await Spicetify.Platform.PlayerAPI.getQueue()).nextUp;n&&(e=n.context.uri,u.debug("lastContextUri: "+f),i={contextUri:e,trackUri:n.item.uri,trackName:n.item.name,index:n.index,progressMs:n.positionAsOfTimestamp,isShuffled:r,nextFrom:i},e!==f&&(u.debug(`Context changed from ${f} to `+e),u.info(`pushing new context to storage. playing: ${i.trackName}. next up: `+(null==(t=null==(t=i.nextFrom)?void 0:t[0])?void 0:t.name)),t=i,(o=d()).push(t),o.length>s&&(u.info("Max stack size reached. Removing oldest items."),o.splice(0,o.length-s)),p(o),0),f=e)},250)})}async function y(){r=d(),a=r.pop(),p(r);var r=a;if(r){if(u.info("restoring previous context:",r),await Spicetify.Player.playUri(r.contextUri,{featureIdentifier:"context_back_button"},{skipTo:{index:r.index.itemIndex,pageIndex:null!=(a=r.index.pageIndex)?a:0}}),null!=(a=r.nextFrom)&&a.length){{var a=r.nextFrom;u.debug("addToNext",a);let e=a.map(e=>({uri:e.uri})),t=e.reduce((e,t)=>(e.push(t.uri),e),[]),o=(u.debug("uriObjects:",e),await Spicetify.Platform.PlayerAPI.getQueue()),i=(u.debug("queue:",o),o.nextUp.filter(e=>t.includes(e.uri))),n={uri:null==(a=o.nextUp[0])?void 0:a.uri,uid:null==(a=o.nextUp[0])?void 0:a.uid};await Spicetify.Platform.PlayerAPI.insertIntoQueue(e,l({},n.uri?{before:n}:{})).then(()=>u.debug("Added to Play Next")).catch(e=>{u.error("Failed to add to queue",e),Spicetify.showNotification("Unable to Add! Check Console.",!0)}),await Spicetify.Platform.PlayerAPI.removeFromQueue(i).then(()=>u.debug("Removed from Play Next")).catch(e=>{u.error("Failed to remove from queue",e),Spicetify.showNotification("Unable to Add! Check Console.",!0)})}await 0,u.info("Restored context and Next From")}}else Spicetify.showNotification("No previous context")}i=Object.defineProperty,n=Object.getOwnPropertySymbols,r=Object.prototype.hasOwnProperty,a=Object.prototype.propertyIsEnumerable,c=(e,t,o)=>t in e?i(e,t,{enumerable:!0,configurable:!0,writable:!0,value:o}):e[t]=o,l=(e,t)=>{for(var o in t=t||{})r.call(t,o)&&c(e,o,t[o]);if(n)for(var o of n(t))a.call(t,o)&&c(e,o,t[o]);return e},(u=class{static debug(...e){u.VERBOSE&&u.info(...e)}static info(...e){u.ENABLED&&console.log(...e)}static warning(...e){u.ENABLED&&console.warn(...e)}static error(...e){u.ENABLED&&console.error(...e)}}).ENABLED=!1,u.VERBOSE=!1,t="contextStack",s=3,f=null,window.printContextHistory=function(){var e=d();0===e.length?console.log("No context history"):e.forEach((e,t)=>{console.log(`context ${t}, playing: ${e.trackName}, next up: ${null==(t=null==(t=e.nextFrom)?void 0:t[0])?void 0:t.name}, ${null==(t=null==(t=e.nextFrom)?void 0:t[1])?void 0:t.name}, `+(null==(e=null==(t=e.nextFrom)?void 0:t[2])?void 0:e.name))})},window.clearContextHistory=function(){localStorage.removeItem(t)},e=async function(){for(u.info("Starting context-history");null==Spicetify||!Spicetify.showNotification;)await new Promise(e=>setTimeout(e,100));u.debug("Context History loaded"),o(),new Spicetify.Playbar.Button("Go to previous context","chevron-left",()=>{y(),Spicetify.showNotification("Restored previous context")},!1,!1)},(async()=>{await e()})()})();